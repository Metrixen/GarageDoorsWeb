@page
@using GarageDoorsWeb.Models
@model IndexModel
@{
    ViewData["Title"] = "Home Page";
}

<h1>Welcome to My Garage Doors</h1>
<table class="table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Door Name</th>
            <th>Is Open</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var door in Model.Doors)
        {
            <tr>
                <td>@door.DoorID</td>
                <td>@door.DoorName</td>
                <td>@door.IsOpen</td>
                <td>
                    <form method="post" asp-page-handler="ToggleDoor" asp-route-doorId="@door.DoorID">
                        <button id="btn-@door.DoorID" type="submit" class="btn btn-primary">Change Status</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Check if a button was previously clicked and needs to be disabled
        const disabledButtonId = localStorage.getItem('disabledButtonId');
        const disabledUntil = localStorage.getItem('disabledUntil');
        const currentTime = new Date().getTime();

        if (disabledButtonId && disabledUntil && currentTime < disabledUntil) {
            const buttonToDisable = document.getElementById(disabledButtonId);
            if (buttonToDisable) {
                buttonToDisable.disabled = true;
                // Calculate remaining time and set timeout to re-enable the button
                const remainingTime = disabledUntil - currentTime;
                setTimeout(() => {
                    buttonToDisable.disabled = false;
                    // Clear the localStorage after re-enabling the button
                    localStorage.removeItem('disabledButtonId');
                    localStorage.removeItem('disabledUntil');
                }, remainingTime);
            }
        }

        // Attach event listeners to all buttons
        const buttons = document.querySelectorAll('button[type="submit"]');
        buttons.forEach(button => {
            button.addEventListener('click', function () {
                // Save the ID of the clicked button and the disabled time (20 seconds from now) to localStorage
                localStorage.setItem('disabledButtonId', this.id);
                const disableDuration = 1000; // 1 seconds
                const disableUntil = new Date().getTime() + disableDuration;
                localStorage.setItem('disabledUntil', disableUntil);
            });
        });
    });
</script>



